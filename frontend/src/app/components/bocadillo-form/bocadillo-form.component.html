<div class="card">
  <div class="card-title-container">
    <h2>{{ isEditMode() ? 'Editar Pedido de Bocadillo' : 'Nuevo Pedido de Bocadillo' }}</h2>
    <div class="user-badge">
      <span class="user-icon">ðŸ‘¤</span>
      <span class="user-name">{{ userName }}</span>
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- BotÃ³n para cargar Ãºltimo bocadillo -->
    <div class="form-group" *ngIf="!isEditMode()">
      <button
        type="button"
        class="btn btn-outline-primary btn-load-last"
        (click)="loadLastBocadillo()"
        [disabled]="isLoadingLastBocadillo || isSubmitting"
      >
        {{ isLoadingLastBocadillo ? 'Cargando...' : 'Seleccionar Ãšltimo Bocadillo' }}
      </button>
    </div>

    <!-- Bocata Predefinido -->
    <div class="form-group">
      <label for="bocataPredefinido">Bocata Predefinido (Opcional)</label>
      <select
        id="bocataPredefinido"
        class="form-control"
        formControlName="bocataPredefinido"
        (change)="seleccionarBocataPredefinido($event)"
      >
        <option value="">-- Selecciona o crea tu propio bocata --</option>
        <option *ngFor="let bocata of bocatasPredefinidos" [value]="bocata.nombre">
          {{ bocata.nombre }}
        </option>
      </select>
    </div>

    <!-- TamaÃ±o -->
    <div class="form-group">
      <label>TamaÃ±o *</label>
      <div class="radio-group">
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tamano"
            [value]="TamanoBocadillo.NORMAL"
          />
          Normal
        </label>
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tamano"
            [value]="TamanoBocadillo.GRANDE"
          />
          Grande
        </label>
      </div>
    </div>

    <!-- Tipo de Pan -->
    <div class="form-group">
      <label>Tipo de Pan *</label>
      <div class="radio-group">
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tipoPan"
            [value]="TipoPan.NORMAL"
          />
          Normal
        </label>
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tipoPan"
            [value]="TipoPan.INTEGRAL"
            [disabled]="isPanDisabled(TipoPan.INTEGRAL)"
          />
          Integral (solo normal)
        </label>
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tipoPan"
            [value]="TipoPan.SEMILLAS"
            [disabled]="isPanDisabled(TipoPan.SEMILLAS)"
          />
          Semillas (solo normal)
        </label>
      </div>
    </div>

    <!-- Ingredientes con Autocompletado -->
    <div class="form-group">
      <label for="ingredientes">Ingredientes *</label>
      <div class="autocomplete-container">
        <input
          type="text"
          id="ingredientes"
          class="form-control"
          [value]="ingredienteInput"
          (input)="onIngredienteInputChange($event)"
          placeholder="Buscar ingredientes..."
        />

        <!-- Lista de sugerencias -->
        <ul class="suggestions" *ngIf="showIngredientesSuggestions">
          <li
            *ngFor="let ingrediente of ingredientesFiltrados"
            (click)="agregarIngrediente(ingrediente)"
          >
            {{ ingrediente }}
          </li>
        </ul>
      </div>

      <!-- Ingredientes seleccionados -->
      <div class="selected-items" *ngIf="ingredientesSeleccionados.length > 0">
        <span
          *ngFor="let ingrediente of ingredientesSeleccionados"
          class="chip"
        >
          {{ ingrediente }}
          <button
            type="button"
            class="chip-remove"
            (click)="quitarIngrediente(ingrediente)"
          >
            Ã—
          </button>
        </span>
      </div>

      <div class="error-message" *ngIf="ingredientesSeleccionados.length === 0 && errorMessage">
        Debes seleccionar al menos un ingrediente
      </div>
    </div>

    <!-- Error general -->
    <div class="alert alert-danger" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="isSubmitting"
      >
        <ng-container *ngIf="isEditMode()">
          {{ isSubmitting ? 'Actualizando...' : 'Actualizar Pedido' }}
        </ng-container>
        <ng-container *ngIf="!isEditMode()">
          {{ isSubmitting ? 'Creando...' : 'Crear Pedido' }}
        </ng-container>
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="resetForm()"
        [disabled]="isSubmitting"
      >
        {{ isEditMode() ? 'Cancelar' : 'Limpiar' }}
      </button>
    </div>
  </form>
</div>
