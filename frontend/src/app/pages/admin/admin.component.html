<div class="container">
  <header class="header">
    <h1>Panel de Administraci√≥n</h1>
    <nav class="nav">
      <button (click)="goToOrders()" class="nav-btn">Pedidos</button>
      <button class="nav-btn active">Alquimista</button>
      <button (click)="goToIngredientes()" class="nav-btn">Ingredientes</button>
      <button (click)="goToUsers()" class="nav-btn">Usuarios</button>
      <button (click)="goToPayments()" class="nav-btn">Pagos</button>
      <button (click)="logout()" class="logout-btn">Cerrar Sesi√≥n</button>
    </nav>
  </header>

  <!-- Control de Estado de Pedidos -->
  <div class="card control-pedidos" *ngIf="systemConfig">
    <h2>üîí Control de Pedidos de la Semana</h2>

    <div class="status-indicator">
      <span class="status-badge" [class.open]="!systemConfig.manuallyClosedOrders" [class.closed]="systemConfig.manuallyClosedOrders">
        {{ systemConfig.manuallyClosedOrders ? 'üî¥ CERRADO' : 'üü¢ ABIERTO' }}
      </span>
      <p class="status-text">
        {{ systemConfig.manuallyClosedOrders
          ? 'Los usuarios no pueden realizar pedidos esta semana'
          : 'Los usuarios pueden realizar pedidos normalmente' }}
      </p>
    </div>

    <!-- Formulario para mensaje de cierre -->
    <div class="closure-message-form" *ngIf="showClosureMessageInput">
      <label for="closureMessage">Mensaje para los usuarios:</label>
      <textarea
        id="closureMessage"
        class="form-control"
        [(ngModel)]="customClosureMessage"
        rows="3"
        placeholder="Ej: El servicio de bocadillos est√° cerrado esta semana. Vuelve a probar la pr√≥xima semana."
      ></textarea>
      <div class="closure-actions">
        <button
          class="btn btn-primary"
          (click)="toggleOrders()"
          [disabled]="isTogglingOrders || !customClosureMessage.trim()">
          {{ isTogglingOrders ? 'Cerrando...' : 'Confirmar Cierre' }}
        </button>
        <button class="btn btn-secondary" (click)="cancelClosureMessage()">
          Cancelar
        </button>
      </div>
    </div>

    <!-- Bot√≥n de acci√≥n principal -->
    <div class="action-container" *ngIf="!showClosureMessageInput">
      <button
        class="btn"
        [class.btn-danger]="!systemConfig.manuallyClosedOrders"
        [class.btn-success]="systemConfig.manuallyClosedOrders"
        (click)="toggleOrders()"
        [disabled]="isTogglingOrders">
        {{ isTogglingOrders
          ? 'Actualizando...'
          : (systemConfig.manuallyClosedOrders ? '‚úÖ Abrir Pedidos' : 'üö´ Cerrar Pedidos') }}
      </button>

      <p class="current-message" *ngIf="systemConfig.manuallyClosedOrders && systemConfig.closureMessage">
        <strong>Mensaje actual:</strong><br>
        "{{ systemConfig.closureMessage }}"
      </p>
    </div>
  </div>

<div class="card">
  <h2>üßô‚Äç‚ôÇÔ∏è Gesti√≥n del Bocadillo Alquimista</h2>
  <p class="subtitle">Define el bocadillo sorpresa de esta semana</p>

  <div class="loading" *ngIf="isLoading">Cargando...</div>

  <form *ngIf="!isLoading" [formGroup]="form" (ngSubmit)="onSubmit()">
    <!-- Tama√±o -->
    <div class="form-group">
      <label>Tama√±o *</label>
      <div class="radio-group">
        <label class="radio-label">
          <input type="radio" formControlName="tamano" [value]="TamanoBocadillo.NORMAL" />
          Normal
        </label>
        <label class="radio-label">
          <input type="radio" formControlName="tamano" [value]="TamanoBocadillo.GRANDE" />
          Grande
        </label>
      </div>
    </div>

    <!-- Tipo de Pan -->
    <div class="form-group">
      <label>Tipo de Pan *</label>
      <div class="radio-group">
        <label class="radio-label">
          <input type="radio" formControlName="tipoPan" [value]="TipoPan.NORMAL" />
          Normal
        </label>
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tipoPan"
            [value]="TipoPan.INTEGRAL"
            [disabled]="isPanDisabled(TipoPan.INTEGRAL)"
          />
          Integral (solo normal)
        </label>
        <label class="radio-label">
          <input
            type="radio"
            formControlName="tipoPan"
            [value]="TipoPan.SEMILLAS"
            [disabled]="isPanDisabled(TipoPan.SEMILLAS)"
          />
          Semillas (solo normal)
        </label>
      </div>
    </div>

    <!-- Ingredientes con Autocompletado -->
    <div class="form-group">
      <label for="ingredientes">Ingredientes Secretos *</label>
      <div class="autocomplete-container">
        <input
          type="text"
          id="ingredientes"
          class="form-control"
          [value]="ingredienteInput"
          (input)="onIngredienteInputChange($event)"
          placeholder="Buscar ingredientes..."
        />

        <!-- Lista de sugerencias -->
        <ul class="suggestions" *ngIf="showIngredientesSuggestions">
          <li
            *ngFor="let ingrediente of ingredientesFiltrados"
            (click)="agregarIngrediente(ingrediente)"
          >
            {{ ingrediente }}
          </li>
        </ul>
      </div>

      <!-- Ingredientes seleccionados -->
      <div class="selected-items" *ngIf="ingredientesSeleccionados.length > 0">
        <span *ngFor="let ingrediente of ingredientesSeleccionados" class="chip">
          {{ ingrediente }}
          <button
            type="button"
            class="chip-remove"
            (click)="quitarIngrediente(ingrediente)"
          >
            √ó
          </button>
        </span>
      </div>

      <div class="error-message" *ngIf="ingredientesSeleccionados.length === 0 && errorMessage">
        Debes seleccionar al menos un ingrediente
      </div>
    </div>

    <!-- Mensajes -->
    <div class="alert alert-danger" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <div class="alert alert-success" *ngIf="successMessage">
      {{ successMessage }}
    </div>

    <!-- Botones -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
        {{ isSubmitting ? 'Guardando...' : (alquimistaExistente ? 'Actualizar Alquimista' : 'Crear Alquimista') }}
      </button>
      <button
        type="button"
        class="btn btn-secondary"
        (click)="resetForm()"
        [disabled]="isSubmitting"
      >
        Limpiar
      </button>
      <button
        *ngIf="alquimistaExistente"
        type="button"
        class="btn btn-danger"
        (click)="deleteAlquimista()"
        [disabled]="isSubmitting"
      >
        Eliminar Alquimista
      </button>
    </div>
  </form>

  <div class="info-box">
    <h3>‚ÑπÔ∏è Informaci√≥n</h3>
    <ul>
      <li>El bocadillo Alquimista es una opci√≥n sorpresa para los usuarios</li>
      <li>Los usuarios pueden seleccionarlo pero no ver√°n los ingredientes</li>
      <li>Solo t√∫ como administrador puedes ver y editar los ingredientes</li>
      <li>Los ingredientes se revelar√°n en el export a WhatsApp</li>
    </ul>
  </div>
</div>
</div>
